<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.54">

  <meta name="author" content="Kieran Healy">
  <title>Data Visualization with R and the Tidyverse – Data Visualization - 6. Work With Models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f5bde6; background-color: #24273a; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cad3f5; } /* Normal */
    code span.al { color: #ed8796; font-weight: bold; } /* Alert */
    code span.an { color: #eed49f; } /* Annotation */
    code span.at { color: #b7bdf8; } /* Attribute */
    code span.bn { color: #ed8796; } /* BaseN */
    code span.bu { color: #ed8796; } /* BuiltIn */
    code span.cf { color: #c6a0f6; } /* ControlFlow */
    code span.ch { color: #f5bde6; } /* Char */
    code span.cn { color: #8aadf4; } /* Constant */
    code span.co { color: #6e738d; font-style: italic; } /* Comment */
    code span.cv { color: #6e738d; font-style: italic; } /* CommentVar */
    code span.do { color: #ed8796; } /* Documentation */
    code span.dt { color: #c6a0f6; } /* DataType */
    code span.dv { color: #f5a97f; } /* DecVal */
    code span.er { color: #ed8796; text-decoration: underline; } /* Error */
    code span.ex { color: #8aadf4; } /* Extension */
    code span.fl { color: #f5a97f; } /* Float */
    code span.fu { color: #8aadf4; } /* Function */
    code span.im { color: #a6da95; } /* Import */
    code span.in { color: #f5a97f; } /* Information */
    code span.kw { color: #c6a0f6; } /* Keyword */
    code span.op { color: #91d7e3; } /* Operator */
    code span.ot { color: #f5a97f; } /* Other */
    code span.pp { color: #f5bde6; } /* Preprocessor */
    code span.re { color: #6e738d; font-style: italic; } /* RegionMarker */
    code span.sc { color: #f5bde6; } /* SpecialChar */
    code span.ss { color: #ed8796; } /* SpecialString */
    code span.st { color: #a6da95; } /* String */
    code span.va { color: #f5bde6; } /* Variable */
    code span.vs { color: #ed8796; } /* VerbatimString */
    code span.wa { color: #f5a97f; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#252F3E" class="quarto-title-block center">
  <h1 class="title">Data Visualization - 6. Work With Models</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Kieran Healy 
</div>
        <p class="quarto-title-affiliation">
            Code Horizons
          </p>
    </div>
</div>

  <p class="date">October 2024</p>
</section>
<section>
<section id="work-with-models" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Work with <span class="fg-yellow">Models</span></h1>

</section>
<section id="load-our-packages" class="slide level2">
<h2>Load our packages</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)      <span class="co"># manage file paths</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(socviz)    <span class="co"># data and some useful functions</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># your friend and mine</span></span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder) <span class="co"># Everyone's favorite dataset</span></span>
<span id="cb1-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="co"># Tidy model output</span></span>
<span id="cb1-6"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects) <span class="co"># Tidy marginal effects</span></span>
<span id="cb1-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># Tidy summary tables and graphs</span></span>
<span id="cb1-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)    <span class="co"># Format our axes and guides</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>
Attaching package: 'scales'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>The following object is masked from 'package:purrr':

    discard</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
</div>
</section>
<section id="ggplot-can-work-with-models" class="slide level2">
<h2><span class="fg-lblue"><code>ggplot</code></span> can work with models</h2>
<ul>
<li>We know because <code>geoms</code> often do calculations in the background, via their <code>stat</code> functions.</li>
</ul>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(gdpPercap), </span>
<span id="cb5-3"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> lifeExp))  </span>
<span id="cb5-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"tomato"</span>, </span>
<span id="cb5-7"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">"tomato"</span>, </span>
<span id="cb5-8"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> MASS<span class="sc">::</span>rlm) <span class="sc">+</span></span>
<span id="cb5-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, </span>
<span id="cb5-10"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">"steelblue"</span>, </span>
<span id="cb5-11"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb5-12"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Robust and OLS fits"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-model1-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="these-can-be-complex" class="slide level2">
<h2>These can be complex …</h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb6-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"tomato"</span>, </span>
<span id="cb6-3"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb6-4"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">1.2</span>, </span>
<span id="cb6-5"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(x, <span class="dv">3</span>), </span>
<span id="cb6-6"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-model2-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="but-we-usually-wont-do-this-in-ggplot" class="slide level2">
<h2>… but we usually won’t do this in <span class="fg-lblue"><code>ggplot</code></span></h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb7-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_quantile</span>(<span class="at">color =</span> <span class="st">"tomato"</span>, </span>
<span id="cb7-3"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">1.2</span>, </span>
<span id="cb7-4"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"rqss"</span>,</span>
<span id="cb7-5"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> <span class="dv">1</span>, </span>
<span id="cb7-6"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.20</span>, <span class="fl">0.5</span>, <span class="fl">0.85</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-model3-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">Transform and summarize first.</span><br>Then send your clean tables to ggplot.</p>
</div>
</section></section>
<section>
<section id="look-inside-the-box" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-lblue">Look inside</span> <span class="fg-yellow">the box</span></h1>

</section>
<section id="objects-are-to-do-list-bento-boxes" class="slide level2">
<h2>Objects are To-Do List Bento Boxes</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a>gapminder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1,704 × 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# ℹ 1,694 more rows</code></pre>
</div>
</div>
</section>
<section id="fit-a-model" class="slide level2">
<h2>Fit a model</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> lifeExp <span class="sc">~</span> gdpPercap <span class="sc">+</span> <span class="fu">log</span>(pop) <span class="sc">+</span> continent, </span>
<span id="cb10-2"><a aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> gapminder)</span>
<span id="cb10-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
Call:
lm(formula = lifeExp ~ gdpPercap + log(pop) + continent, data = gapminder)

Residuals:
    Min      1Q  Median      3Q     Max 
-47.490  -4.614   0.250   5.293  26.094 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3.816e+01  2.050e+00  18.618  &lt; 2e-16 ***
gdpPercap         4.557e-04  2.345e-05  19.435  &lt; 2e-16 ***
log(pop)          6.394e-01  1.329e-01   4.810 1.64e-06 ***
continentAmericas 1.308e+01  6.063e-01  21.579  &lt; 2e-16 ***
continentAsia     7.784e+00  5.810e-01  13.398  &lt; 2e-16 ***
continentEurope   1.695e+01  6.350e-01  26.691  &lt; 2e-16 ***
continentOceania  1.764e+01  1.779e+00   9.916  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.336 on 1697 degrees of freedom
Multiple R-squared:  0.585, Adjusted R-squared:  0.5835 
F-statistic: 398.7 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="poke-around-inside" class="slide level2">
<h2>Poke around inside</h2>

<img data-src="img/06_lm_object_schematic.png" class="r-stretch quarto-figure-center"><p class="caption">Use the Object Inspector to take a look</p></section></section>
<section>
<section id="predict-from-models-diy-method" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-yellow">Predict from models:</span><br> <span class="fg-lblue">DIY method</span></h1>

</section>
<section id="behind-the-curtain" class="slide level2">
<h2>Behind the curtain</h2>
<ul>
<li><span class="fg-green"><code>predict()</code></span> and its methods do a lot of work behind the scenes</li>
<li>We won’t usually need to do this stuff manually. But the idea is that the generic <span class="fg-green"><code>predict()</code></span> function has <em>methods</em> for specific sorts of models. Give it a model and some new data and it will produce predicted values for the new data. Here’s an example.</li>
</ul>
</section>
<section id="the-labor-intensive-way" class="slide level2">
<h2>The labor-intensive way</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a>min_gdp <span class="ot">&lt;-</span> <span class="fu">min</span>(gapminder<span class="sc">$</span>gdpPercap)</span>
<span id="cb12-2"><a aria-hidden="true" tabindex="-1"></a>max_gdp <span class="ot">&lt;-</span> <span class="fu">max</span>(gapminder<span class="sc">$</span>gdpPercap)</span>
<span id="cb12-3"><a aria-hidden="true" tabindex="-1"></a>med_pop <span class="ot">&lt;-</span> <span class="fu">median</span>(gapminder<span class="sc">$</span>pop)</span>
<span id="cb12-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Make a grid of predictor values</span></span>
<span id="cb12-6"><a aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">gdpPercap =</span> (<span class="fu">seq</span>(<span class="at">from =</span> min_gdp,</span>
<span id="cb12-7"><a aria-hidden="true" tabindex="-1"></a>                                        <span class="at">to =</span> max_gdp,</span>
<span id="cb12-8"><a aria-hidden="true" tabindex="-1"></a>                                        <span class="at">length.out =</span> <span class="dv">100</span>)),</span>
<span id="cb12-9"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">pop =</span> med_pop,</span>
<span id="cb12-10"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">continent =</span> <span class="fu">c</span>(<span class="st">"Africa"</span>, <span class="st">"Americas"</span>,</span>
<span id="cb12-11"><a aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Oceania"</span>))</span>
<span id="cb12-12"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a aria-hidden="true" tabindex="-1"></a>pred_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 500 × 3
   gdpPercap      pop continent
       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    
 1      241. 7023596. Africa   
 2      241. 7023596. Americas 
 3      241. 7023596. Asia     
 4      241. 7023596. Europe   
 5      241. 7023596. Oceania  
 6     1385. 7023596. Africa   
 7     1385. 7023596. Americas 
 8     1385. 7023596. Asia     
 9     1385. 7023596. Europe   
10     1385. 7023596. Oceania  
# ℹ 490 more rows</code></pre>
</div>
</div>
</section>
<section id="the-labor-intensive-way-1" class="slide level2">
<h2>The labor-intensive way</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Get the predicted values</span></span>
<span id="cb14-2"><a aria-hidden="true" tabindex="-1"></a>pred_out <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> out,</span>
<span id="cb14-3"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> pred_df,</span>
<span id="cb14-4"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb14-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>       fit      lwr      upr
1 48.35388 47.67735 49.03041
2 61.43646 60.43917 62.43375
3 56.13821 55.22045 57.05597
4 65.30361 64.21794 66.38927
5 65.99517 62.55277 69.43757
6 48.87530 48.20261 49.54799</code></pre>
</div>
</div>
</section>
<section id="the-labor-intensive-way-2" class="slide level2">
<h2>The labor-intensive way</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Bind them into one data frame. We can do this safely</span></span>
<span id="cb16-2"><a aria-hidden="true" tabindex="-1"></a><span class="co"># here because we know the row order by construction. </span></span>
<span id="cb16-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># But this is not a safe approach in general.</span></span>
<span id="cb16-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pred_df, pred_out)</span>
<span id="cb16-6"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  gdpPercap     pop continent      fit      lwr      upr
1  241.1659 7023596    Africa 48.35388 47.67735 49.03041
2  241.1659 7023596  Americas 61.43646 60.43917 62.43375
3  241.1659 7023596      Asia 56.13821 55.22045 57.05597
4  241.1659 7023596    Europe 65.30361 64.21794 66.38927
5  241.1659 7023596   Oceania 65.99517 62.55277 69.43757
6 1385.4282 7023596    Africa 48.87530 48.20261 49.54799</code></pre>
</div>
</div>
</section>
<section id="the-labor-intensive-way-3" class="slide level2">
<h2>The labor-intensive way</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">subset</span>(pred_df, continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Europe"</span>, <span class="st">"Africa"</span>)),</span>
<span id="cb18-2"><a aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap,</span>
<span id="cb18-3"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> fit, </span>
<span id="cb18-4"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> lwr, </span>
<span id="cb18-5"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">ymax =</span> upr,</span>
<span id="cb18-6"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> continent,</span>
<span id="cb18-7"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> continent,</span>
<span id="cb18-8"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> continent))</span>
<span id="cb18-9"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Use the original data as the point layer</span></span>
<span id="cb18-11"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(gapminder,</span>
<span id="cb18-12"><a aria-hidden="true" tabindex="-1"></a>                             continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Europe"</span>, <span class="st">"Africa"</span>)),</span>
<span id="cb18-13"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp,</span>
<span id="cb18-14"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> continent),</span>
<span id="cb18-15"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-16"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb18-17"><a aria-hidden="true" tabindex="-1"></a><span class="co"># And the predicted values to draw the lines  </span></span>
<span id="cb18-18"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-19"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">


<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-11-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1152"></section></section>
<section>
<section id="use-broom-to-tidy-models" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-lblue">Use</span> <span class="fg-yellow"><code>broom</code></span> <span class="fg-lblue">to tidy models</span></h1>

</section>
<section id="we-cant-do-anything-with-this" class="slide level2">
<h2>We can’t <span class="fg-yellow">do</span> anything with this</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> lifeExp <span class="sc">~</span> gdpPercap <span class="sc">+</span> <span class="fu">log</span>(pop) <span class="sc">+</span> continent, </span>
<span id="cb19-2"><a aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> gapminder)</span>
<span id="cb19-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
Call:
lm(formula = lifeExp ~ gdpPercap + log(pop) + continent, data = gapminder)

Residuals:
    Min      1Q  Median      3Q     Max 
-47.490  -4.614   0.250   5.293  26.094 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3.816e+01  2.050e+00  18.618  &lt; 2e-16 ***
gdpPercap         4.557e-04  2.345e-05  19.435  &lt; 2e-16 ***
log(pop)          6.394e-01  1.329e-01   4.810 1.64e-06 ***
continentAmericas 1.308e+01  6.063e-01  21.579  &lt; 2e-16 ***
continentAsia     7.784e+00  5.810e-01  13.398  &lt; 2e-16 ***
continentEurope   1.695e+01  6.350e-01  26.691  &lt; 2e-16 ***
continentOceania  1.764e+01  1.779e+00   9.916  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.336 on 1697 degrees of freedom
Multiple R-squared:  0.585, Adjusted R-squared:  0.5835 
F-statistic: 398.7 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="tidy-regression-output-with-broom" class="slide level2">
<h2>Tidy regression output with <span class="fg-yellow">broom</span></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 7 × 5
  term               estimate std.error statistic   p.value
  &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       38.2      2.05          18.6  1.50e- 70
2 gdpPercap          0.000456 0.0000234     19.4  3.98e- 76
3 log(pop)           0.639    0.133          4.81 1.64e-  6
4 continentAmericas 13.1      0.606         21.6  1.85e- 91
5 continentAsia      7.78     0.581         13.4  5.52e- 39
6 continentEurope   16.9      0.635         26.7  2.43e-131
7 continentOceania  17.6      1.78           9.92 1.43e- 22</code></pre>
</div>
</div>
<p>That’s a <em>lot</em> nicer. Now it’s just a tibble. We know those.</p>
</section>
<section id="tidy-regression-output-with-broom-1" class="slide level2">
<h2>Tidy regression output with <span class="fg-yellow">broom</span></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a>out_conf <span class="ot">&lt;-</span> <span class="fu">tidy</span>(out, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-2"><a aria-hidden="true" tabindex="-1"></a>out_conf </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 7 × 7
  term               estimate std.error statistic   p.value  conf.low conf.high
  &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       38.2      2.05          18.6  1.50e- 70 34.1      42.2     
2 gdpPercap          0.000456 0.0000234     19.4  3.98e- 76  0.000410  0.000502
3 log(pop)           0.639    0.133          4.81 1.64e-  6  0.379     0.900   
4 continentAmericas 13.1      0.606         21.6  1.85e- 91 11.9      14.3     
5 continentAsia      7.78     0.581         13.4  5.52e- 39  6.64      8.92    
6 continentEurope   16.9      0.635         26.7  2.43e-131 15.7      18.2     
7 continentOceania  17.6      1.78           9.92 1.43e- 22 14.2      21.1     </code></pre>
</div>
</div>
</section>
<section id="tidy-regression-output-with-broom-2" class="slide level2">
<h2>Tidy regression output with <span class="fg-yellow">broom</span></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a aria-hidden="true" tabindex="-1"></a>out_conf <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%nin%</span> <span class="st">"(Intercept)"</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nicelabs =</span> <span class="fu">prefix_strip</span>(term, <span class="st">"continent"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">relocate</span>(nicelabs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 8
  nicelabs  term       estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;     &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 gdpPercap gdpPercap   4.56e-4 0.0000234     19.4  3.98e- 76  4.10e-4  0.000502
2 log(Pop)  log(pop)    6.39e-1 0.133          4.81 1.64e-  6  3.79e-1  0.900   
3 Americas  continent…  1.31e+1 0.606         21.6  1.85e- 91  1.19e+1 14.3     
4 Asia      continent…  7.78e+0 0.581         13.4  5.52e- 39  6.64e+0  8.92    
5 Europe    continent…  1.69e+1 0.635         26.7  2.43e-131  1.57e+1 18.2     
6 Oceania   continent…  1.76e+1 1.78           9.92 1.43e- 22  1.42e+1 21.1     </code></pre>
</div>
</div>
</section>
<section id="tidy-regression-output-with-broom-3" class="slide level2">
<h2>Tidy regression output with <span class="fg-yellow">broom</span></h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a>out_conf <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%nin%</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nicelabs =</span> <span class="fu">prefix_strip</span>(term, <span class="st">"continent"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> estimate, </span>
<span id="cb28-5"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmin =</span> conf.low, </span>
<span id="cb28-6"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax =</span> conf.high, </span>
<span id="cb28-7"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">reorder</span>(nicelabs, </span>
<span id="cb28-8"><a aria-hidden="true" tabindex="-1"></a>                                   estimate))) <span class="sc">+</span> </span>
<span id="cb28-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span> </span>
<span id="cb28-10"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimate"</span>, </span>
<span id="cb28-11"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb28-12"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Severely Misspecified"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-broomplot-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="three-ways-to-tidy" class="slide level2">
<h2>Three ways to tidy</h2>
<ul>
<li><span class="fg-lblue">Component level</span>: <span class="fg-green"><code>tidy()</code></span></li>
</ul>
</section>
<section id="three-ways-to-tidy-1" class="slide level2">
<h2>Three ways to tidy</h2>
<ul>
<li><span class="fg-lblue">Component level</span>: <span class="fg-green"><code>tidy()</code></span></li>
<li><span class="fg-orange">Observation level</span>: <span class="fg-green"><code>augment()</code></span></li>
</ul>
</section>
<section id="three-ways-to-tidy-2" class="slide level2">
<h2>Three ways to tidy</h2>
<ul>
<li><span class="fg-lblue">Component level</span>: <span class="fg-green"><code>tidy()</code></span></li>
<li><span class="fg-orange">Observation level</span>: <span class="fg-green"><code>augment()</code></span></li>
<li><span class="fg-pink">Model level</span>: <span class="fg-green"><code>glance()</code></span></li>
</ul>
</section>
<section id="component-level" class="slide level2">
<h2><span class="fg-lblue">Component</span> level</h2>
<pre class="text" data-code-line-numbers=""><code>
&gt; summary(out)

Call:
lm(formula = lifeExp ~ gdpPercap + log(pop) + continent, data = gapminder)

Residuals:
    Min      1Q  Median      3Q     Max 
-47.490  -4.614   0.250   5.293  26.094 </code></pre>
<div class="sourceCode" id="cb30" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb30-2"><a aria-hidden="true" tabindex="-1"></a>                   Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb30-3"><a aria-hidden="true" tabindex="-1"></a>(Intercept)       <span class="fl">3.816e+01</span>  <span class="fl">2.050e+00</span>  <span class="fl">18.618</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-4"><a aria-hidden="true" tabindex="-1"></a>gdpPercap         <span class="fl">4.557e-04</span>  <span class="fl">2.345e-05</span>  <span class="fl">19.435</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(pop)          <span class="fl">6.394e-01</span>  <span class="fl">1.329e-01</span>   <span class="fl">4.810</span> <span class="fl">1.64e-06</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-6"><a aria-hidden="true" tabindex="-1"></a>continentAmericas <span class="fl">1.308e+01</span>  <span class="fl">6.063e-01</span>  <span class="fl">21.579</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-7"><a aria-hidden="true" tabindex="-1"></a>continentAsia     <span class="fl">7.784e+00</span>  <span class="fl">5.810e-01</span>  <span class="fl">13.398</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-8"><a aria-hidden="true" tabindex="-1"></a>continentEurope   <span class="fl">1.695e+01</span>  <span class="fl">6.350e-01</span>  <span class="fl">26.691</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-9"><a aria-hidden="true" tabindex="-1"></a>continentOceania  <span class="fl">1.764e+01</span>  <span class="fl">1.779e+00</span>   <span class="fl">9.916</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb30-10"><a aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb30-11"><a aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> ‘<span class="sc">**</span><span class="er">*</span>’ <span class="fl">0.001</span> ‘<span class="sc">**</span>’ <span class="fl">0.01</span> ‘<span class="sc">*</span>’ <span class="fl">0.05</span> ‘.’ <span class="fl">0.1</span> ‘ ’ <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text" data-code-line-numbers=""><code>Residual standard error: 8.336 on 1697 degrees of freedom
Multiple R-squared:  0.585, Adjusted R-squared:  0.5835 
F-statistic: 398.7 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</code></pre>
</section>
<section id="observation-level" class="slide level2">
<h2><span class="fg-orange">Observation</span> level</h2>
<pre class="text" data-code-line-numbers=""><code>
&gt; summary(out)

Call:
lm(formula = lifeExp ~ gdpPercap + log(pop) + continent, data = gapminder)</code></pre>
<div class="sourceCode" id="cb33" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb33-2"><a aria-hidden="true" tabindex="-1"></a>    Min      <span class="dv">1</span>Q  Median      <span class="dv">3</span>Q     Max </span>
<span id="cb33-3"><a aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">47.490</span>  <span class="sc">-</span><span class="fl">4.614</span>   <span class="fl">0.250</span>   <span class="fl">5.293</span>  <span class="fl">26.094</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<pre class="text" data-code-line-numbers=""><code>Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3.816e+01  2.050e+00  18.618  &lt; 2e-16 ***
gdpPercap         4.557e-04  2.345e-05  19.435  &lt; 2e-16 ***
log(pop)          6.394e-01  1.329e-01   4.810 1.64e-06 ***
continentAmericas 1.308e+01  6.063e-01  21.579  &lt; 2e-16 ***
continentAsia     7.784e+00  5.810e-01  13.398  &lt; 2e-16 ***
continentEurope   1.695e+01  6.350e-01  26.691  &lt; 2e-16 ***
continentOceania  1.764e+01  1.779e+00   9.916  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
<pre class="text" data-code-line-numbers=""><code>Residual standard error: 8.336 on 1697 degrees of freedom
Multiple R-squared:  0.585, Adjusted R-squared:  0.5835 
F-statistic: 398.7 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</code></pre>
</section>
<section id="observation-level-1" class="slide level2">
<h2><span class="fg-orange">Observation</span> level</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1,704 × 10
   lifeExp gdpPercap `log(pop)` continent .fitted .resid    .hat .sigma .cooksd
     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1    28.8      779.       15.9 Asia         56.5  -27.7 0.00302   8.31 0.00479
 2    30.3      821.       16.0 Asia         56.6  -26.2 0.00299   8.31 0.00426
 3    32.0      853.       16.1 Asia         56.7  -24.7 0.00296   8.32 0.00372
 4    34.0      836.       16.3 Asia         56.7  -22.7 0.00294   8.32 0.00313
 5    36.1      740.       16.4 Asia         56.8  -20.7 0.00294   8.32 0.00259
 6    38.4      786.       16.5 Asia         56.9  -18.4 0.00292   8.33 0.00205
 7    39.9      978.       16.4 Asia         56.9  -17.0 0.00291   8.33 0.00174
 8    40.8      852.       16.4 Asia         56.9  -16.0 0.00292   8.33 0.00155
 9    41.7      649.       16.6 Asia         56.9  -15.2 0.00294   8.33 0.00140
10    41.8      635.       16.9 Asia         57.1  -15.3 0.00297   8.33 0.00144
# ℹ 1,694 more rows
# ℹ 1 more variable: .std.resid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="observation-level-2" class="slide level2">
<h2><span class="fg-orange">Observation</span> level</h2>
<ul>
<li><p>For OLS models:</p></li>
<li><p><span class="fg-orange">.fitted</span> — The fitted values of the model.</p></li>
<li><p><span class="fg-orange">.se.fit</span> — The standard errors of the fitted values.</p></li>
<li><p><span class="fg-orange">.resid</span> — The residuals.</p></li>
<li><p><span class="fg-orange">.hat</span> — The diagonal of the hat matrix.</p></li>
<li><p><span class="fg-orange">.sigma</span> — An estimate of the residual standard deviation when the corresponding observation is dropped from the model.</p></li>
<li><p><span class="fg-orange">.cooksd</span> — Cook’s distance, a common regression diagnostic.</p></li>
<li><p><span class="fg-orange">.std.resid</span> — The standardized residuals.</p></li>
</ul>
</section>
<section id="observation-level-3" class="slide level2">
<h2><span class="fg-orange">Observation</span> level</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the data argument puts back any additional columns from the original</span></span>
<span id="cb38-2"><a aria-hidden="true" tabindex="-1"></a><span class="co"># tibble</span></span>
<span id="cb38-3"><a aria-hidden="true" tabindex="-1"></a>out_aug <span class="ot">&lt;-</span>  <span class="fu">augment</span>(out, <span class="at">data =</span> gapminder)</span>
<span id="cb38-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out_aug)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 12
  country continent  year lifeExp    pop gdpPercap .fitted .resid    .hat .sigma
  &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 Afghan… Asia       1952    28.8 8.43e6      779.    56.5  -27.7 0.00302   8.31
2 Afghan… Asia       1957    30.3 9.24e6      821.    56.6  -26.2 0.00299   8.31
3 Afghan… Asia       1962    32.0 1.03e7      853.    56.7  -24.7 0.00296   8.32
4 Afghan… Asia       1967    34.0 1.15e7      836.    56.7  -22.7 0.00294   8.32
5 Afghan… Asia       1972    36.1 1.31e7      740.    56.8  -20.7 0.00294   8.32
6 Afghan… Asia       1977    38.4 1.49e7      786.    56.9  -18.4 0.00292   8.33
# ℹ 2 more variables: .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals vs Fitted Values</span></span>
<span id="cb40-2"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> out_aug,</span>
<span id="cb40-3"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid))</span>
<span id="cb40-4"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">


<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-21-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1440"><p>(I told you it was misspecified)</p>
</section>
<section id="model-level" class="slide level2">
<h2><span class="fg-pink">Model</span> level</h2>
<pre class="text" data-code-line-numbers=""><code>
&gt; summary(out)

Call:
lm(formula = lifeExp ~ gdpPercap + log(pop) + continent, data = gapminder)

Residuals:
    Min      1Q  Median      3Q     Max 
-47.490  -4.614   0.250   5.293  26.094 </code></pre>
<pre class="text" data-code-line-numbers=""><code>Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3.816e+01  2.050e+00  18.618  &lt; 2e-16 ***
gdpPercap         4.557e-04  2.345e-05  19.435  &lt; 2e-16 ***
log(pop)          6.394e-01  1.329e-01   4.810 1.64e-06 ***
continentAmericas 1.308e+01  6.063e-01  21.579  &lt; 2e-16 ***
continentAsia     7.784e+00  5.810e-01  13.398  &lt; 2e-16 ***
continentEurope   1.695e+01  6.350e-01  26.691  &lt; 2e-16 ***
continentOceania  1.764e+01  1.779e+00   9.916  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
<div class="sourceCode" id="cb43" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">8.336</span> on <span class="dv">1697</span> degrees of freedom</span>
<span id="cb43-2"><a aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.585</span>, Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.5835</span> </span>
<span id="cb43-3"><a aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">398.7</span> on <span class="dv">6</span> and <span class="dv">1697</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-level-1" class="slide level2">
<h2><span class="fg-pink">Model</span> level</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic   p.value    df logLik    AIC    BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1     0.585         0.584  8.34      399. 1.01e-319     6 -6028. 12072. 12115.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<p>The usefulness of <span class="fg-green"><code>glance()</code></span> becomes clearer when dealing with ensembles of models.</p>
</section></section>
<section>
<section id="example" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Example</h1>

</section>
<section id="a-kaplan-meier-curve" class="slide level2">
<h2>A Kaplan-Meier Curve</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb46-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss
1    3  306      2  74   1       1       90       100     1175      NA
2    3  455      2  68   1       0       90        90     1225      15
3    3 1010      1  56   1       0       90        90       NA      15
4    5  210      2  57   1       1       90        60     1150      11
5    1  883      2  60   1       0      100        90       NA       0
6   12 1022      1  74   1       1       50        80      513       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>    inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss
223    1  116      2  76   1       1       80        80       NA       0
224    1  188      1  77   1       1       80        60       NA       3
225   13  191      1  39   1       0       90        90     2350      -5
226   32  105      1  75   2       2       60        70     1025       5
227    6  174      1  66   1       1       90       100     1075       1
228   22  177      1  58   2       1       80        90     1060       0</code></pre>
</div>
</div>
</section>
<section id="a-kaplan-meier-curve-1" class="slide level2">
<h2>A Kaplan-Meier Curve</h2>
<p>First we fit the model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Hazard model</span></span>
<span id="cb50-2"><a aria-hidden="true" tabindex="-1"></a>out_cph <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb50-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out_cph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>Call:
coxph(formula = Surv(time, status) ~ age + sex, data = lung)

  n= 228, number of events= 165 

         coef exp(coef)  se(coef)      z Pr(&gt;|z|)   
age  0.017045  1.017191  0.009223  1.848  0.06459 . 
sex -0.513219  0.598566  0.167458 -3.065  0.00218 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

    exp(coef) exp(-coef) lower .95 upper .95
age    1.0172     0.9831    0.9990    1.0357
sex    0.5986     1.6707    0.4311    0.8311

Concordance= 0.603  (se = 0.025 )
Likelihood ratio test= 14.12  on 2 df,   p=9e-04
Wald test            = 13.47  on 2 df,   p=0.001
Score (logrank) test = 13.72  on 2 df,   p=0.001</code></pre>
</div>
</div>
</section>
<section id="a-kaplan-meier-curve-2" class="slide level2">
<h2>A Kaplan-Meier Curve</h2>
<p>Then we create the survival curve, which is <em>nearly</em> tidy out of the box:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Hazard model</span></span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a>out_surv <span class="ot">&lt;-</span> <span class="fu">survfit</span>(out_cph)</span>
<span id="cb52-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a aria-hidden="true" tabindex="-1"></a><span class="do">## See how this is just a print method,</span></span>
<span id="cb52-5"><a aria-hidden="true" tabindex="-1"></a><span class="do">## not a tibble, or even a data frame.</span></span>
<span id="cb52-6"><a aria-hidden="true" tabindex="-1"></a><span class="do">## So it just runs off the end of the slide.</span></span>
<span id="cb52-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out_surv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>Call: survfit(formula = out_cph)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    5    228       1   0.9958 0.00417       0.9877        1.000
   11    227       3   0.9833 0.00831       0.9671        1.000
   12    224       1   0.9791 0.00928       0.9611        0.997
   13    223       2   0.9706 0.01096       0.9494        0.992
   15    221       1   0.9664 0.01170       0.9438        0.990
   26    220       1   0.9622 0.01240       0.9382        0.987
   30    219       1   0.9579 0.01305       0.9327        0.984
   31    218       1   0.9537 0.01368       0.9273        0.981
   53    217       2   0.9452 0.01484       0.9165        0.975
   54    215       1   0.9409 0.01538       0.9112        0.972
   59    214       1   0.9366 0.01590       0.9060        0.968
   60    213       2   0.9280 0.01689       0.8955        0.962
   61    211       1   0.9237 0.01735       0.8903        0.958
   62    210       1   0.9194 0.01780       0.8852        0.955
 [ reached getOption("max.print") -- omitted 125 rows ]</code></pre>
</div>
</div>
</section>
<section id="a-kaplan-meier-curve-3" class="slide level2">
<h2>A Kaplan-Meier Curve</h2>
<p>Then we tidy it and draw the plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Much nicer. (See how the column headers have been regularized, too.)</span></span>
<span id="cb54-2"><a aria-hidden="true" tabindex="-1"></a>out_tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(out_surv)</span>
<span id="cb54-3"><a aria-hidden="true" tabindex="-1"></a>out_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 186 × 8
    time n.risk n.event n.censor estimate std.error conf.high conf.low
   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1     5    228       1        0    0.996   0.00419     1        0.988
 2    11    227       3        0    0.983   0.00845     1.00     0.967
 3    12    224       1        0    0.979   0.00947     0.997    0.961
 4    13    223       2        0    0.971   0.0113      0.992    0.949
 5    15    221       1        0    0.966   0.0121      0.990    0.944
 6    26    220       1        0    0.962   0.0129      0.987    0.938
 7    30    219       1        0    0.958   0.0136      0.984    0.933
 8    31    218       1        0    0.954   0.0143      0.981    0.927
 9    53    217       2        0    0.945   0.0157      0.975    0.917
10    54    215       1        0    0.941   0.0163      0.972    0.911
# ℹ 176 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56" data-source-line-numbers="nil" data-code-line-numbers="4,5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> out_tidy <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> estimate)) <span class="sc">+</span> </span>
<span id="cb56-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb56-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb56-5"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">


<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-27-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1440"><p>Kaplan-Meier Plot</p>
</section></section>
<section>
<section id="grouped-analysis-with-broom" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-yellow">Grouped Analysis with</span> <span class="fg-lblue"><code>broom</code></span></h1>

</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">Pipelines show their real power</span> <span class="fg-lblue">when used iteratively</span></p>
</div>
</section>
<section id="iteration-without-tears-or-explicit-loops" class="slide level2">
<h2>Iteration without tears (or explicit loops)</h2>
<ul>
<li>You might be familiar with code that looks like this:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb57-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb57-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x <span class="sc">+</span> i)</span>
<span id="cb57-5"><a aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 11
[1] 12
[1] 13
[1] 14
[1] 15</code></pre>
</div>
</div>
<ul>
<li>This is one way to do something repeatedly.</li>
</ul>
</section>
<section id="iteration-without-tears-or-explicit-loops-1" class="slide level2">
<h2>Iteration without tears (or explicit loops)</h2>
<ul>
<li>We can also write, e.g.,</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>)</span>
<span id="cb59-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb59-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add 5 to the ith element of x</span></span>
<span id="cb59-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x[i] <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb59-6"><a aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 15
[1] 25
[1] 35
[1] 45</code></pre>
</div>
</div>
<ul>
<li>This way we can refer to each element of x in turn, and do the same thing do it.</li>
</ul>
</section>
<section id="iteration-without-tears-or-explicit-loops-2" class="slide level2">
<h2>Iteration without tears (or explicit loops)</h2>
<ul>
<li>The more complicated the thing we want to do, the more likely we are to use functions to help us out.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb61-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb61-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">sqrt</span>(x <span class="sc">+</span> i))</span>
<span id="cb61-5"><a aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 3.316625
[1] 3.464102
[1] 3.605551
[1] 3.741657
[1] 3.872983</code></pre>
</div>
</div>
</section>
<section id="isnt-this-like-vectorized-arithmetic" class="slide level2">
<h2>Isn’t this like … Vectorized arithmetic?</h2>
<ul>
<li>The simplest cases are not that different from the vectorized arithmetic we saw before.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb63-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb63-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a aria-hidden="true" tabindex="-1"></a><span class="co"># You know what R will do here</span></span>
<span id="cb63-6"><a aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1]  2  3  4  5  6  7  8  9 10 11</code></pre>
</div>
</div>
</section>
<section id="isnt-this-like-vectorized-arithmetic-1" class="slide level2">
<h2>Isn’t this like … Vectorized arithmetic?</h2>
<ul>
<li>The simplest cases are not that different from the vectorized arithmetic we saw before.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb65-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a aria-hidden="true" tabindex="-1"></a><span class="co"># You know what R will do here</span></span>
<span id="cb65-6"><a aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1]  2  3  4  5  6  7  8  9 10 11</code></pre>
</div>
</div>
<p>R’s vectorized rules add <code>b</code> to every element of <code>a</code>. In a sense, the <span class="fg-green"><strong><code>+</code></strong></span> operation can be thought of as a function that takes each element of <code>a</code> and does something with it. In this case “add <code>b</code>”.</p>
</section>
<section id="repeatedly-applying-a-function" class="slide level2">
<h2>Repeatedly applying a function</h2>
<p>We can make this explicit by writing a function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb67-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a aria-hidden="true" tabindex="-1"></a>add_b <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb67-5"><a aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb67-6"><a aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> b <span class="co"># for any x</span></span>
<span id="cb67-7"><a aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">add_b</span>(<span class="at">x =</span> a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1]  2  3  4  5  6  7  8  9 10 11</code></pre>
</div>
</div>
<p>In effect we take the vector <strong><code>a</code></strong> and feed it to the <span class="fg-green"><code>add_b()</code></span> function one element at a time.</p>
</section>
<section id="repeatedly-applying-a-function-1" class="slide level2">
<h2>Repeatedly applying a function</h2>
<p>Again, R’s vectorized approach means it automatically applies <span class="fg-green"><code>add_b()</code></span> to every element of the x we give it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">add_b</span>(<span class="at">x =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 11</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">add_b</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">99</span>, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1]    2  100 1001</code></pre>
</div>
</div>
</section>
<section id="iterating-in-a-pipeline" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>Some operations can’t directly be vectorized in this way, most often because the function we want to apply only knows what to do if it is handed, say, a vector. It doesn’t understand what to do if it’s handed a list of vectors or a tibble of them, etc. This is when we might find ourselves manually iterating—writing out every single step explicitly.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb74-2"><a aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb74-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">country_n =</span> <span class="fu">n_distinct</span>(country), </span>
<span id="cb74-4"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">continent_n =</span> <span class="fu">n_distinct</span>(continent), </span>
<span id="cb74-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">year_n =</span> <span class="fu">n_distinct</span>(year), </span>
<span id="cb74-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">lifeExp_n =</span> <span class="fu">n_distinct</span>(lifeExp), </span>
<span id="cb74-7"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">population_n =</span> <span class="fu">n_distinct</span>(population))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 5
  country_n continent_n year_n lifeExp_n population_n
      &lt;int&gt;       &lt;int&gt;  &lt;int&gt;     &lt;int&gt;        &lt;int&gt;
1       142           5     12      1626         4060</code></pre>
</div>
</div>
<p>That’s tedious to write! Computers are supposed to allow us to avoid that sort of thing.</p>
</section>
<section id="iterating-in-a-pipeline-1" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>So how would we iterate this? What we want is to apply the <span class="fg-green"><strong><code>n_distinct()</code></strong></span> function to each column of <code>gapminder</code>. But we can’t easily write a loop inside a pipeline. We want a way to iterate that lets us repeatedly apply a function without explicitly writing a loop.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb76-2"><a aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb76-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">n_distinct</span>(country), </span>
<span id="cb76-4"><a aria-hidden="true" tabindex="-1"></a>            <span class="fu">n_distinct</span>(continent), </span>
<span id="cb76-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="fu">n_distinct</span>(year), </span>
<span id="cb76-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="fu">n_distinct</span>(lifeExp), </span>
<span id="cb76-7"><a aria-hidden="true" tabindex="-1"></a>            <span class="fu">n_distinct</span>(population))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 5
  `n_distinct(country)` `n_distinct(continent)` `n_distinct(year)`
                  &lt;int&gt;                   &lt;int&gt;              &lt;int&gt;
1                   142                       5                 12
# ℹ 2 more variables: `n_distinct(lifeExp)` &lt;int&gt;,
#   `n_distinct(population)` &lt;int&gt;</code></pre>
</div>
</div>

<aside><div>
<p>Using <span class="fg-green"><strong><code>n_distinct()</code></strong></span> in this context is an idea I got from Rebecca Barter’s discussion of <code>purrr</code>.</p>
</div></aside></section>
<section id="iterating-in-a-pipeline-2" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>In real life, you’d use <span class="fg-green"><strong>across()</strong></span>, like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb78-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), n_distinct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 6
  country continent  year lifeExp   pop gdpPercap
    &lt;int&gt;     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
1     142         5    12    1626  1704      1704</code></pre>
</div>
</div>
</section>
<section id="iterating-in-a-pipeline-3" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>But you could also say “Feed each column of <span class="fg-pink"><code>gapminder</code></span> in turn to the <span class="fg-green"><code>n_distinct()</code></span> function”. This is what <span class="fg-green"><code>map()</code></span> is for.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(gapminder, n_distinct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>$country
[1] 142

$continent
[1] 5

$year
[1] 12

$lifeExp
[1] 1626

$pop
[1] 1704

$gdpPercap
[1] 1704</code></pre>
</div>
</div>
<p>Read it as “Feed each column of <code>gapminder</code> to the <span class="fg-green"><strong><code>n_distinct()</code></strong></span> function.</p>
<p>(This is pretty much what <span class="fg-green"><strong><code>across()</code></strong></span> is doing more nicely.)</p>
</section>
<section id="iterating-in-a-pipeline-4" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>Or, in pipeline form:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb82-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(n_distinct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>$country
[1] 142

$continent
[1] 5

$year
[1] 12

$lifeExp
[1] 1626

$pop
[1] 1704

$gdpPercap
[1] 1704</code></pre>
</div>
</div>
<p>You can see we are getting a <em>list</em> back.</p>
</section>
<section id="iterating-in-a-pipeline-5" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>Or, in pipeline form:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb84-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(n_distinct)</span>
<span id="cb84-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a aria-hidden="true" tabindex="-1"></a>result<span class="sc">$</span>continent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 5</code></pre>
</div>
</div>
</section>
<section id="iterating-in-a-pipeline-6" class="slide level2">
<h2><span class="fg-green">Iterating</span> in a pipeline</h2>
<p>But we know <span class="fg-green"><strong><code>n_distinct()</code></strong></span> should always return an integer. So we use <span class="fg-green"><strong><code>map_int()</code></strong></span> instead of the generic <span class="fg-green"><strong><code>map()</code></strong></span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">|&gt;</span>  </span>
<span id="cb90-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(n_distinct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  country continent      year   lifeExp       pop gdpPercap 
      142         5        12      1626      1704      1704 </code></pre>
</div>
</div>
<p>The thing about the <span class="fg-green"><strong><code>map()</code></strong></span> family is that it can deal with all kinds of input types and output types.</p>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">So what’s the use</span> <span class="fg-lblue">of all that stuff?</span></p>
</div>
</section>
<section id="grouped-analysis-and-list-columns" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>Let’s say I want to fit a model to data for all countries in Europe in 1977.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a aria-hidden="true" tabindex="-1"></a>eu77 <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span> </span>
<span id="cb92-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>, year <span class="sc">==</span> <span class="dv">1977</span>)</span>
<span id="cb92-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> <span class="fu">log</span>(gdpPercap), <span class="at">data =</span> eu77)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
Call:
lm(formula = lifeExp ~ log(gdpPercap), data = eu77)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.4956 -1.0306  0.0935  1.1755  3.7125 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      29.489      7.161   4.118 0.000306 ***
log(gdpPercap)    4.488      0.756   5.936 2.17e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.114 on 28 degrees of freedom
Multiple R-squared:  0.5572,    Adjusted R-squared:  0.5414 
F-statistic: 35.24 on 1 and 28 DF,  p-value: 2.173e-06</code></pre>
</div>
</div>
</section>
<section id="grouped-analysis-and-list-columns-1" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>What if I want to do that for all Continent-Year combinations?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95" data-source-line-numbers="nil" data-code-line-numbers="2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a aria-hidden="true" tabindex="-1"></a>out_le <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span> <span class="fu">group_by</span>(continent, year) <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">nest</span>() </span>
<span id="cb95-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a aria-hidden="true" tabindex="-1"></a>out_le</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 60 × 3
# Groups:   continent, year [60]
   continent  year data             
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;           
 1 Asia       1952 &lt;tibble [33 × 4]&gt;
 2 Asia       1957 &lt;tibble [33 × 4]&gt;
 3 Asia       1962 &lt;tibble [33 × 4]&gt;
 4 Asia       1967 &lt;tibble [33 × 4]&gt;
 5 Asia       1972 &lt;tibble [33 × 4]&gt;
 6 Asia       1977 &lt;tibble [33 × 4]&gt;
 7 Asia       1982 &lt;tibble [33 × 4]&gt;
 8 Asia       1987 &lt;tibble [33 × 4]&gt;
 9 Asia       1992 &lt;tibble [33 × 4]&gt;
10 Asia       1997 &lt;tibble [33 × 4]&gt;
# ℹ 50 more rows</code></pre>
</div>
</div>
<p>Think of nesting as a kind of “super-grouping”. Look in the object inspector.</p>
</section>
<section id="grouped-analysis-and-list-columns-2" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>Europe ’77 is still in there.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a aria-hidden="true" tabindex="-1"></a>out_le <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">1977</span>) <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 30 × 6
# Groups:   continent, year [1]
   continent  year country                lifeExp      pop gdpPercap
   &lt;fct&gt;     &lt;int&gt; &lt;fct&gt;                    &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Europe     1977 Albania                   68.9  2509048     3533.
 2 Europe     1977 Austria                   72.2  7568430    19749.
 3 Europe     1977 Belgium                   72.8  9821800    19118.
 4 Europe     1977 Bosnia and Herzegovina    69.9  4086000     3528.
 5 Europe     1977 Bulgaria                  70.8  8797022     7612.
 6 Europe     1977 Croatia                   70.6  4318673    11305.
 7 Europe     1977 Czech Republic            70.7 10161915    14800.
 8 Europe     1977 Denmark                   74.7  5088419    20423.
 9 Europe     1977 Finland                   72.5  4738902    15605.
10 Europe     1977 France                    73.8 53165019    18293.
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="grouped-analysis-and-list-columns-3" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>Here we write a tiny, very specific function and <span class="fg-green"><strong><code>map()</code></strong></span> it to every row in the <code>data</code> column.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99" data-source-line-numbers="nil" data-code-line-numbers="8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a aria-hidden="true" tabindex="-1"></a>fit_ols <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb99-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(lifeExp <span class="sc">~</span> <span class="fu">log</span>(gdpPercap), <span class="at">data =</span> df)</span>
<span id="cb99-3"><a aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a aria-hidden="true" tabindex="-1"></a>out_le <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span></span>
<span id="cb99-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">|&gt;</span></span>
<span id="cb99-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb99-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, fit_ols)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouped-analysis-and-list-columns-4" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<ul>
<li>Now we have a new column. Each row of the <span class="fg-orange"><code>model</code></span> column contains a full regression for that continent-year.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb100" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a aria-hidden="true" tabindex="-1"></a>out_le</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 60 × 4
# Groups:   continent, year [60]
   continent  year data              model 
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt;
 1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
 9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
# ℹ 50 more rows</code></pre>
</div>
</div>
</section>
<section id="grouped-analysis-and-list-columns-5" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>We can tidy the nested models, too.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a aria-hidden="true" tabindex="-1"></a>fit_ols <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb102-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(lifeExp <span class="sc">~</span> <span class="fu">log</span>(gdpPercap), <span class="at">data =</span> df)</span>
<span id="cb102-3"><a aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a aria-hidden="true" tabindex="-1"></a>out_tidy <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span></span>
<span id="cb102-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">|&gt;</span></span>
<span id="cb102-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb102-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, fit_ols),</span>
<span id="cb102-9"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) </span>
<span id="cb102-10"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a aria-hidden="true" tabindex="-1"></a>out_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 60 × 5
# Groups:   continent, year [60]
   continent  year data              model  tidied          
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt; &lt;list&gt;          
 1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
 9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [2 × 5]&gt;
# ℹ 50 more rows</code></pre>
</div>
</div>
</section>
<section id="grouped-analysis-and-list-columns-6" class="slide level2">
<h2>Grouped analysis and <span class="fg-orange">list columns</span></h2>
<p>We can get the tidied results out into the main table if we like.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a aria-hidden="true" tabindex="-1"></a>out_tidy <span class="ot">&lt;-</span> out_tidy <span class="sc">|&gt;</span></span>
<span id="cb104-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(tidied)) <span class="sc">|&gt;</span></span>
<span id="cb104-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%nin%</span> <span class="st">"(Intercept)"</span> <span class="sc">&amp;</span></span>
<span id="cb104-4"><a aria-hidden="true" tabindex="-1"></a>           continent <span class="sc">%nin%</span> <span class="st">"Oceania"</span>)</span>
<span id="cb104-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a aria-hidden="true" tabindex="-1"></a>out_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 48 × 9
# Groups:   continent, year [48]
   continent  year data     model  term     estimate std.error statistic p.value
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;   &lt;list&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 Asia       1952 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.16     1.25       3.33 2.28e-3
 2 Asia       1957 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.17     1.28       3.26 2.71e-3
 3 Asia       1962 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.59     1.24       3.72 7.94e-4
 4 Asia       1967 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.50     1.15       3.90 4.77e-4
 5 Asia       1972 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.44     1.01       4.41 1.16e-4
 6 Asia       1977 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.87     1.03       4.75 4.42e-5
 7 Asia       1982 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     4.78     0.852      5.61 3.77e-6
 8 Asia       1987 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     5.17     0.727      7.12 5.31e-8
 9 Asia       1992 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     5.09     0.649      7.84 7.60e-9
10 Asia       1997 &lt;tibble&gt; &lt;lm&gt;   log(gdp…     5.11     0.628      8.15 3.35e-9
# ℹ 38 more rows</code></pre>
</div>
</div>
</section>
<section id="plot-what-we-have" class="slide level2">
<h2>Plot what we have</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106" data-source-line-numbers="nil" data-code-line-numbers="10,11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> out_tidy,</span>
<span id="cb106-2"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate,</span>
<span id="cb106-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> estimate <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>std.error,</span>
<span id="cb106-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> estimate <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>std.error,</span>
<span id="cb106-5"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> continent, </span>
<span id="cb106-6"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> continent))</span>
<span id="cb106-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb106-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>), </span>
<span id="cb106-10"><a aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fu">rel</span>(<span class="fl">1.3</span>))) <span class="sc">+</span></span>
<span id="cb106-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">unique</span>(gapminder<span class="sc">$</span>year)) <span class="sc">+</span> </span>
<span id="cb106-12"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, </span>
<span id="cb106-13"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Estimate"</span>, </span>
<span id="cb106-14"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Continent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">


<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-53-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1440"><p>Repeated Estimates of log GDP on Life Expectancy by Continent</p>
</section>
<section id="and-theres-more" class="slide level2">
<h2>And there’s more …</h2>
<p>Let’s go back to this stage:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># New model</span></span>
<span id="cb107-2"><a aria-hidden="true" tabindex="-1"></a>fit_ols2 <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb107-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(lifeExp <span class="sc">~</span> <span class="fu">log</span>(gdpPercap) <span class="sc">+</span> <span class="fu">log</span>(pop), <span class="at">data =</span> df)</span>
<span id="cb107-4"><a aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a aria-hidden="true" tabindex="-1"></a>out_tidy <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span></span>
<span id="cb107-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">|&gt;</span></span>
<span id="cb107-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-9"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, fit_ols2),</span>
<span id="cb107-10"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy)) </span>
<span id="cb107-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a aria-hidden="true" tabindex="-1"></a>out_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 60 × 5
# Groups:   continent, year [60]
   continent  year data              model  tidied          
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt; &lt;list&gt;          
 1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
 9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;   &lt;tibble [3 × 5]&gt;
# ℹ 50 more rows</code></pre>
</div>
</div>
</section>
<section id="a-function-to-draw-a-coef-plot" class="slide level2">
<h2>A function to draw a coef plot</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the output from our model</span></span>
<span id="cb109-2"><a aria-hidden="true" tabindex="-1"></a>mod_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, </span>
<span id="cb109-3"><a aria-hidden="true" tabindex="-1"></a>                     title){</span>
<span id="cb109-4"><a aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb109-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%nin%</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb109-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> estimate,</span>
<span id="cb109-7"><a aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmin =</span> estimate <span class="sc">-</span> std.error,</span>
<span id="cb109-8"><a aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> estimate <span class="sc">+</span> std.error,</span>
<span id="cb109-9"><a aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">reorder</span>(term, estimate))) <span class="sc">+</span> </span>
<span id="cb109-10"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pointrange</span>() <span class="sc">+</span> </span>
<span id="cb109-11"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, </span>
<span id="cb109-12"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb109-13"><a aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-it-using-map2-or-pmap" class="slide level2">
<h2>Add it using <span class="fg-green"><code>map2()</code></span> or <span class="fg-green"><code>pmap()</code></span></h2>
<ul>
<li>When we have two arguments to feed a function we can use <span class="fg-green"><code>map2()</code></span>. The general case is <span class="fg-green"><code>pmap()</code></span>, for passing any number of arguments in a list.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110" data-source-line-numbers="nil" data-code-line-numbers="3,5,6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a aria-hidden="true" tabindex="-1"></a>out_tidy <span class="ot">&lt;-</span> gapminder <span class="sc">|&gt;</span> <span class="fu">group_by</span>(continent, year) <span class="sc">|&gt;</span> <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">paste</span>(continent, year),</span>
<span id="cb110-3"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> <span class="fu">map</span>(data, fit_ols2),</span>
<span id="cb110-4"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">tidied =</span> <span class="fu">map</span>(model, tidy), </span>
<span id="cb110-5"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">ggout =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(tidied, title), </span>
<span id="cb110-6"><a aria-hidden="true" tabindex="-1"></a>                        mod_plot)) </span>
<span id="cb110-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a aria-hidden="true" tabindex="-1"></a>out_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 60 × 7
# Groups:   continent, year [60]
   continent  year data              title     model  tidied           ggout 
   &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;chr&gt;     &lt;list&gt; &lt;list&gt;           &lt;list&gt;
 1 Asia       1952 &lt;tibble [33 × 4]&gt; Asia 1952 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 2 Asia       1957 &lt;tibble [33 × 4]&gt; Asia 1957 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 3 Asia       1962 &lt;tibble [33 × 4]&gt; Asia 1962 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 4 Asia       1967 &lt;tibble [33 × 4]&gt; Asia 1967 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 5 Asia       1972 &lt;tibble [33 × 4]&gt; Asia 1972 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 6 Asia       1977 &lt;tibble [33 × 4]&gt; Asia 1977 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 7 Asia       1982 &lt;tibble [33 × 4]&gt; Asia 1982 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 8 Asia       1987 &lt;tibble [33 × 4]&gt; Asia 1987 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
 9 Asia       1992 &lt;tibble [33 × 4]&gt; Asia 1992 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
10 Asia       1997 &lt;tibble [33 × 4]&gt; Asia 1997 &lt;lm&gt;   &lt;tibble [3 × 5]&gt; &lt;gg&gt;  
# ℹ 50 more rows</code></pre>
</div>
</div>
<p>Now, every element of <span class="fg-orange"><code>ggout</code></span> is …</p>
</section>
<section id="a-plot" class="slide level2">
<h2>A plot!</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a aria-hidden="true" tabindex="-1"></a>out_tidy<span class="sc">$</span>ggout[[<span class="dv">8</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-57-1.png" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
</div><div class="column right" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb113" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a aria-hidden="true" tabindex="-1"></a>out_tidy<span class="sc">$</span>ggout[[<span class="dv">18</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-58-1.png" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="we-dont-just-put-them-in-there-for-fun" class="slide level2">
<h2>We don’t just put them in there for fun</h2>
<ul>
<li>We can e.g.&nbsp;<span class="fg-green"><code>walk</code></span> the plots out to disk</li>
</ul>
<p><span class="fg-green"><code>walk()</code></span> is <span class="fg-green"><code>map()</code></span> for when you just want a “side-effect” such as printed output. There is also <span class="fg-green"><code>walk2()</code></span> and <span class="fg-green"><code>pwalk()</code></span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">pwalk</span>(</span>
<span id="cb114-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb114-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(out_tidy<span class="sc">$</span>title, <span class="st">".png"</span>),</span>
<span id="cb114-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> out_tidy<span class="sc">$</span>ggout,</span>
<span id="cb114-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">here</span>(<span class="st">"figures"</span>),</span>
<span id="cb114-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb114-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb114-8"><a aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb114-9"><a aria-hidden="true" tabindex="-1"></a>  ggsave</span>
<span id="cb114-10"><a aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="peek-in-the-figures-folder" class="slide level2">
<h2>Peek in the <span class="fg-orange"><code>figures/</code></span> folder</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="fu">here</span>(<span class="st">"figures"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb115-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">basename</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Africa 1952.png"   "Africa 1957.png"   "Africa 1962.png"  
 [4] "Africa 1967.png"   "Africa 1972.png"   "Africa 1977.png"  
 [7] "Africa 1982.png"   "Africa 1987.png"   "Africa 1992.png"  
[10] "Africa 1997.png"   "Africa 2002.png"   "Africa 2007.png"  
[13] "Americas 1952.png" "Americas 1957.png" "Americas 1962.png"
[16] "Americas 1967.png" "Americas 1972.png" "Americas 1977.png"
[19] "Americas 1982.png" "Americas 1987.png" "Americas 1992.png"
[22] "Americas 1997.png" "Americas 2002.png" "Americas 2007.png"
[25] "Asia 1952.png"     "Asia 1957.png"     "Asia 1962.png"    
[28] "Asia 1967.png"     "Asia 1972.png"     "Asia 1977.png"    
[31] "Asia 1982.png"     "Asia 1987.png"     "Asia 1992.png"    
[34] "Asia 1997.png"     "Asia 2002.png"     "Asia 2007.png"    
[37] "Europe 1952.png"   "Europe 1957.png"   "Europe 1962.png"  
[40] "Europe 1967.png"   "Europe 1972.png"   "Europe 1977.png"  
[43] "Europe 1982.png"   "Europe 1987.png"   "Europe 1992.png"  
[46] "Europe 1997.png"   "Europe 2002.png"   "Europe 2007.png"  
[49] "Oceania 1952.png"  "Oceania 1957.png"  "Oceania 1962.png" 
[52] "Oceania 1967.png"  "Oceania 1972.png"  "Oceania 1977.png" 
[55] "Oceania 1982.png"  "Oceania 1987.png"  "Oceania 1992.png" 
[58] "Oceania 1997.png"  "Oceania 2002.png"  "Oceania 2007.png" </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-yellow">Get model-based graphics</span> <span class="fg-lblue">right</span></p>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-green">Present findings in substantive terms</span></p>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-lblue">Show degrees of confidence or uncertainty</span></p>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-pink">Show the data when you can</span></p>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-blue">But all this applies</span> to data in <em>any</em> format. <span class="fg-pink">Graphs are not special here!</span></p>
</div>
</section></section>
<section>
<section id="plot-marginal-effects-with-the-marginaleffects-package" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-lblue">Plot Marginal Effects</span> with the <span class="fg-lblue"><code>marginaleffects</code></span> package</h1>

</section>
<section id="an-example-from-the-gss" class="slide level2">
<h2>An example from the GSS</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a aria-hidden="true" tabindex="-1"></a>gss_sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 2,867 × 32
    year    id ballot       age childs sibs   degree race  sex   region income16
   &lt;dbl&gt; &lt;dbl&gt; &lt;labelled&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;labe&gt; &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;   
 1  2016     1 1             47      3 2      Bache… White Male  New E… $170000…
 2  2016     2 2             61      0 3      High … White Male  New E… $50000 …
 3  2016     3 3             72      2 3      Bache… White Male  New E… $75000 …
 4  2016     4 1             43      4 3      High … White Fema… New E… $170000…
 5  2016     5 3             55      2 2      Gradu… White Fema… New E… $170000…
 6  2016     6 2             53      2 2      Junio… White Fema… New E… $60000 …
 7  2016     7 1             50      2 2      High … White Male  New E… $170000…
 8  2016     8 3             23      3 6      High … Other Fema… Middl… $30000 …
 9  2016     9 1             45      3 5      High … Black Male  Middl… $60000 …
10  2016    10 3             71      4 1      Junio… White Male  Middl… $60000 …
# ℹ 2,857 more rows
# ℹ 21 more variables: relig &lt;fct&gt;, marital &lt;fct&gt;, padeg &lt;fct&gt;, madeg &lt;fct&gt;,
#   partyid &lt;fct&gt;, polviews &lt;fct&gt;, happy &lt;fct&gt;, partners &lt;fct&gt;, grass &lt;fct&gt;,
#   zodiac &lt;fct&gt;, pres12 &lt;labelled&gt;, wtssall &lt;dbl&gt;, income_rc &lt;fct&gt;,
#   agegrp &lt;fct&gt;, ageq &lt;fct&gt;, siblings &lt;fct&gt;, kids &lt;fct&gt;, religion &lt;fct&gt;,
#   bigregion &lt;fct&gt;, partners_rc &lt;fct&gt;, obama &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="set-up-our-model" class="slide level2">
<h2>Set up our model</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a aria-hidden="true" tabindex="-1"></a>gss_sm<span class="sc">$</span>polviews_m <span class="ot">&lt;-</span> <span class="fu">relevel</span>(gss_sm<span class="sc">$</span>polviews, </span>
<span id="cb119-2"><a aria-hidden="true" tabindex="-1"></a>                             <span class="at">ref =</span> <span class="st">"Moderate"</span>)</span>
<span id="cb119-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a aria-hidden="true" tabindex="-1"></a>out_bo <span class="ot">&lt;-</span> <span class="fu">glm</span>(obama <span class="sc">~</span> polviews_m <span class="sc">+</span> sex<span class="sc">*</span>race,</span>
<span id="cb119-5"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb119-6"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> gss_sm)</span>
<span id="cb119-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(out_bo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 12 × 5
   term                             estimate std.error statistic  p.value
   &lt;chr&gt;                               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)                       0.296       0.134   2.21    2.70e- 2
 2 polviews_mExtremely Liberal       2.37        0.525   4.52    6.20e- 6
 3 polviews_mLiberal                 2.60        0.357   7.29    3.10e-13
 4 polviews_mSlightly Liberal        1.29        0.248   5.21    1.94e- 7
 5 polviews_mSlightly Conservative  -1.36        0.181  -7.48    7.68e-14
 6 polviews_mConservative           -2.35        0.200 -11.7     1.07e-31
 7 polviews_mExtremely Conservative -2.73        0.387  -7.04    1.87e-12
 8 sexFemale                         0.255       0.145   1.75    7.96e- 2
 9 raceBlack                         3.85        0.501   7.68    1.61e-14
10 raceOther                        -0.00214     0.436  -0.00492 9.96e- 1
11 sexFemale:raceBlack              -0.198       0.660  -0.299   7.65e- 1
12 sexFemale:raceOther               1.57        0.588   2.68    7.37e- 3</code></pre>
</div>
</div>
</section>
<section id="calculate-the-average-marginal-effects" class="slide level2">
<h2>Calculate the Average Marginal Effects</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb121-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a aria-hidden="true" tabindex="-1"></a>bo_mfx <span class="ot">&lt;-</span> <span class="fu">avg_slopes</span>(out_bo)</span>
<span id="cb121-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a aria-hidden="true" tabindex="-1"></a><span class="do">## This gives us the marginal effects at the unit level </span></span>
<span id="cb121-6"><a aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(bo_mfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 9 × 12
  term       contrast    estimate std.error statistic   p.value s.value conf.low
  &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 polviews_m mean(Conse…  -0.412     0.0283    -14.5  6.82e- 48  157.   -0.467  
2 polviews_m mean(Extre…  -0.454     0.0420    -10.8  3.55e- 27   87.9  -0.536  
3 polviews_m mean(Extre…   0.268     0.0295      9.10 9.07e- 20   63.3   0.210  
4 polviews_m mean(Liber…   0.277     0.0229     12.1  1.46e- 33  109.    0.232  
5 polviews_m mean(Sligh…  -0.266     0.0330     -8.06 7.65e- 16   50.2  -0.330  
6 polviews_m mean(Sligh…   0.193     0.0303      6.39 1.66e- 10   32.5   0.134  
7 race       mean(Black…   0.403     0.0173     23.4  1.18e-120  398.    0.369  
8 race       mean(Other…   0.125     0.0386      3.23 1.24e-  3    9.66  0.0490 
9 sex        mean(Femal…   0.0443    0.0177      2.51 1.22e-  2    6.36  0.00967
# ℹ 4 more variables: conf.high &lt;dbl&gt;, predicted_lo &lt;dbl&gt;, predicted_hi &lt;dbl&gt;,
#   predicted &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="alternatively-do-it-with-broom" class="slide level2">
<h2>Alternatively, do it with <span class="fg-lblue"><code>broom</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb123" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(bo_mfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 9 × 12
  term       contrast    estimate std.error statistic   p.value s.value conf.low
  &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 polviews_m mean(Conse…  -0.412     0.0283    -14.5  6.82e- 48  157.   -0.467  
2 polviews_m mean(Extre…  -0.454     0.0420    -10.8  3.55e- 27   87.9  -0.536  
3 polviews_m mean(Extre…   0.268     0.0295      9.10 9.07e- 20   63.3   0.210  
4 polviews_m mean(Liber…   0.277     0.0229     12.1  1.46e- 33  109.    0.232  
5 polviews_m mean(Sligh…  -0.266     0.0330     -8.06 7.65e- 16   50.2  -0.330  
6 polviews_m mean(Sligh…   0.193     0.0303      6.39 1.66e- 10   32.5   0.134  
7 race       mean(Black…   0.403     0.0173     23.4  1.18e-120  398.    0.369  
8 race       mean(Other…   0.125     0.0386      3.23 1.24e-  3    9.66  0.0490 
9 sex        mean(Femal…   0.0443    0.0177      2.51 1.22e-  2    6.36  0.00967
# ℹ 4 more variables: conf.high &lt;dbl&gt;, predicted_lo &lt;dbl&gt;, predicted_hi &lt;dbl&gt;,
#   predicted &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="which-gets-us-back-to-familiar-territory" class="slide level2">
<h2>Which gets us back to familiar territory</h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb125" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(bo_mfx) <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> estimate, </span>
<span id="cb125-3"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmin =</span> conf.low, </span>
<span id="cb125-4"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax =</span> conf.high,</span>
<span id="cb125-5"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">reorder</span>(contrast, </span>
<span id="cb125-6"><a aria-hidden="true" tabindex="-1"></a>                                   estimate))) <span class="sc">+</span> </span>
<span id="cb125-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"gray70"</span>,</span>
<span id="cb125-8"><a aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)) <span class="sc">+</span></span>
<span id="cb125-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb125-10"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Average Marginal Effect"</span>, </span>
<span id="cb125-11"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-meffects-1.png" class="quarto-figure quarto-figure-center" width="672"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="marginaleffects-can-do-a-lot-more" class="slide level2">
<h2><span class="fg-lblue"><code>marginaleffects</code></span> can do a lot more</h2>

<img data-src="img/06_marginaleffects_package.png" class="r-stretch"></section>
<section id="marginaleffects-can-do-a-lot-more-1" class="slide level2">
<h2><span class="fg-lblue"><code>marginaleffects</code></span> can do a lot more</h2>
<ul>
<li><p><span class="medium">It includes a range of plotting methods, to produce graphics directly.</span></p></li>
<li><p><span class="medium">These are built on <span class="fg-lblue"><code>ggplot</code></span>. Similarly integration with <span class="fg-lblue"><code>broom</code></span> means that you can use the package-specific plotting functions take the tidy output and adapt it to your own needs.</span></p></li>
<li><p><span class="medium">Also check out <span class="fg-lblue"><code>modelsummary</code></span>, by the same author, for quick and flexible summaries of models and datasets. Again, this sort of package is very convenient to use directly. But with just a little facility with R and tidyverse-style idioms and patterns, you’ll get even more out of it. You’ll better understand how to adapt it and why its functions work as they do.</span></p></li>
</ul>
</section></section>
<section>
<section id="complex-surveys-with-the-survey-and-srvyr-packages" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1><span class="fg-lblue">Complex Surveys</span> with the <span class="fg-lblue"><code>survey</code></span> <span class="fg-yellow">and</span> <span class="fg-lblue"><code>srvyr</code></span> packages</h1>

</section>
<section id="working-with-complex-surveys" class="slide level2">
<h2>Working with complex surveys</h2>
<ul>
<li><p>As always, our question is “What’s the smoothest way for me to get a <span class="fg-orange">tidy table of results</span> I need to hand off to <span class="fg-lblue"><code>ggplot</code></span>?”</p></li>
<li><p>For complex surveys, we use <span class="fg-lblue"><code>survey</code></span>, the standard package for survey analysis in R, and <span class="fg-lblue"><code>srvyr</code></span>, a helper package designed to integrate what <span class="fg-lblue"><code>survey</code></span> can do with the Tiydverse framework.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb126" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Load the packages</span></span>
<span id="cb126-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb126-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-the-gss-again" class="slide level2">
<h2>Example: The GSS again</h2>
<p>This time, a small piece of the full GSS from the early 1970s to 2018.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb127" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a aria-hidden="true" tabindex="-1"></a>gss_lon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 62,466 × 25
    year    id ballot age   degree race  sex   siblings kids  bigregion income16
   &lt;dbl&gt; &lt;dbl&gt; &lt;labe&gt; &lt;lab&gt; &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   
 1  1972     1 NA     23    Bache… White Fema… 3        0     Midwest   &lt;NA&gt;    
 2  1972     2 NA     70    Lt Hi… White Male  4        4+    Midwest   &lt;NA&gt;    
 3  1972     3 NA     48    High … White Fema… 5        4+    Midwest   &lt;NA&gt;    
 4  1972     4 NA     27    Bache… White Fema… 5        0     Midwest   &lt;NA&gt;    
 5  1972     5 NA     61    High … White Fema… 2        2     Midwest   &lt;NA&gt;    
 6  1972     6 NA     26    High … White Male  1        0     Midwest   &lt;NA&gt;    
 7  1972     7 NA     28    High … White Male  6+       2     Midwest   &lt;NA&gt;    
 8  1972     8 NA     27    Bache… White Male  1        0     Midwest   &lt;NA&gt;    
 9  1972     9 NA     21    High … Black Fema… 2        2     South     &lt;NA&gt;    
10  1972    10 NA     30    High … Black Fema… 6+       4+    South     &lt;NA&gt;    
# ℹ 62,456 more rows
# ℹ 14 more variables: religion &lt;fct&gt;, marital &lt;fct&gt;, padeg &lt;fct&gt;, madeg &lt;fct&gt;,
#   partyid &lt;fct&gt;, polviews &lt;fct&gt;, happy &lt;fct&gt;, partners_rc &lt;fct&gt;, grass &lt;fct&gt;,
#   zodiac &lt;fct&gt;, pres12 &lt;labelled&gt;, wtssall &lt;dbl&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="add-the-weighting-information" class="slide level2">
<h2>Add the weighting information</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb129" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># These details are dependent on the kind of survey you're working with</span></span>
<span id="cb129-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb129-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">na.action=</span><span class="st">"na.pass"</span>)</span>
<span id="cb129-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a aria-hidden="true" tabindex="-1"></a>gss_svy <span class="ot">&lt;-</span> gss_lon <span class="sc">|&gt;</span> </span>
<span id="cb129-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1974</span>) <span class="sc">|&gt;</span> </span>
<span id="cb129-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stratvar =</span> <span class="fu">interaction</span>(year, vstrat)) <span class="sc">|&gt;</span> </span>
<span id="cb129-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> vpsu,</span>
<span id="cb129-9"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> stratvar,</span>
<span id="cb129-10"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> wtssall,</span>
<span id="cb129-11"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-12"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a aria-hidden="true" tabindex="-1"></a>gss_svy <span class="co"># Now it's no longer simply a tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>Stratified 1 - level Cluster Sampling design (with replacement)
With (4399) clusters.
Called via srvyr
Sampling variables:
  - ids: vpsu 
  - strata: stratvar 
  - weights: wtssall 
Data variables: 
  - year (dbl), id (dbl), ballot (labelled), age (labelled), degree (fct), race
    (fct), sex (fct), siblings (fct), kids (fct), bigregion (fct), income16
    (fct), religion (fct), marital (fct), padeg (fct), madeg (fct), partyid
    (fct), polviews (fct), happy (fct), partners_rc (fct), grass (fct), zodiac
    (fct), pres12 (labelled), wtssall (dbl), vpsu (dbl), vstrat (dbl), stratvar
    (fct)</code></pre>
</div>
</div>
</section>
<section id="trends-in-the-happy-measure" class="slide level2">
<h2>Trends in the <span class="fg-orange"><code>happy</code></span> measure</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb131" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a aria-hidden="true" tabindex="-1"></a>out_hap <span class="ot">&lt;-</span> gss_svy <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year, happy)  <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">prop =</span> <span class="fu">survey_mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vartype =</span> <span class="st">"ci"</span>))</span>
<span id="cb131-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a aria-hidden="true" tabindex="-1"></a>out_hap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 111 × 5
# Groups:   year [28]
    year happy            prop prop_low prop_upp
   &lt;dbl&gt; &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1975 Very Happy    0.333   0.304     0.361  
 2  1975 Pretty Happy  0.534   0.504     0.565  
 3  1975 Not Too Happy 0.129   0.108     0.150  
 4  1975 &lt;NA&gt;          0.00375 0.000362  0.00714
 5  1976 Very Happy    0.348   0.321     0.376  
 6  1976 Pretty Happy  0.529   0.504     0.555  
 7  1976 Not Too Happy 0.122   0.104     0.141  
 8  1977 Very Happy    0.357   0.330     0.384  
 9  1977 Pretty Happy  0.532   0.504     0.560  
10  1977 Not Too Happy 0.110   0.0918    0.128  
# ℹ 101 more rows</code></pre>
</div>
</div>
<p>Once again, it’s now a tidy tibble, and we know what to do with those.</p>
</section>
<section id="trends-in-the-happy-measure-1" class="slide level2">
<h2>Trends in the <span class="fg-orange"><code>happy</code></span> measure</h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb133" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a aria-hidden="true" tabindex="-1"></a>out_hap <span class="sc">|&gt;</span>  </span>
<span id="cb133-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(happy <span class="sc">==</span> <span class="st">"Not Too Happy"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb133-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, </span>
<span id="cb133-4"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> prop,</span>
<span id="cb133-5"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin =</span> prop_low, </span>
<span id="cb133-6"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax =</span> prop_upp)) <span class="sc">+</span></span>
<span id="cb133-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb133-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb133-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> </span>
<span id="cb133-10"><a aria-hidden="true" tabindex="-1"></a>                       <span class="fu">seq</span>(<span class="dv">1978</span>, <span class="dv">2018</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb133-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> </span>
<span id="cb133-12"><a aria-hidden="true" tabindex="-1"></a>                       <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb133-13"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb133-14"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percent"</span>,</span>
<span id="cb133-15"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Trends in Unhappiness"</span>, </span>
<span id="cb133-16"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"1975-2018"</span>, </span>
<span id="cb133-17"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data: GSS."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-gssaltfig-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="with-a-better-aspect-ratio" class="slide level2">
<h2>With a better aspect ratio</h2>

<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-72-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1056"></section>
<section id="a-more-complex-example" class="slide level2">
<h2>A more complex example</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb134" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a aria-hidden="true" tabindex="-1"></a>gss_svy <span class="sc">|&gt;</span></span>
<span id="cb134-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1976</span>, <span class="dv">2016</span>, <span class="at">by =</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb134-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, race, degree) <span class="sc">|&gt;</span></span>
<span id="cb134-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prop =</span> <span class="fu">survey_mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 162 × 5
# Groups:   year, race [30]
    year race  degree            prop prop_se
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;            &lt;dbl&gt;   &lt;dbl&gt;
 1  1976 White Lt High School 0.327   0.0160 
 2  1976 White High School    0.517   0.0161 
 3  1976 White Junior College 0.0128  0.00298
 4  1976 White Bachelor       0.101   0.00955
 5  1976 White Graduate       0.0392  0.00642
 6  1976 White &lt;NA&gt;           0.00285 0.00151
 7  1976 Black Lt High School 0.558   0.0603 
 8  1976 Black High School    0.335   0.0476 
 9  1976 Black Junior College 0.0423  0.0192 
10  1976 Black Bachelor       0.0577  0.0238 
# ℹ 152 more rows</code></pre>
</div>
</div>
</section>
<section id="lets-put-that-in-an-object" class="slide level2">
<h2>Let’s put that in an object</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb136" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a aria-hidden="true" tabindex="-1"></a>out_yrd <span class="ot">&lt;-</span> gss_svy <span class="sc">|&gt;</span></span>
<span id="cb136-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1976</span>, <span class="dv">2016</span>, <span class="at">by =</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb136-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, race, degree) <span class="sc">|&gt;</span></span>
<span id="cb136-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prop =</span> <span class="fu">survey_mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-sums" class="slide level2">
<h2>Check the sums</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb137" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a aria-hidden="true" tabindex="-1"></a>out_yrd <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, race) <span class="sc">|&gt;</span> </span>
<span id="cb137-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot =</span> <span class="fu">sum</span>(prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 30 × 3
# Groups:   year [10]
    year race    tot
   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1  1976 White  1.00
 2  1976 Black  1.00
 3  1976 Other  1   
 4  1980 White  1.00
 5  1980 Black  1   
 6  1980 Other  1   
 7  1984 White  1.00
 8  1984 Black  1.00
 9  1984 Other  1   
10  1988 White  1.00
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="set-up-the-plot" class="slide level2">
<h2>Set up the plot</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb139" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> out_yrd <span class="sc">|&gt;</span> </span>
<span id="cb139-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(race <span class="sc">%nin%</span> <span class="st">"Other"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb139-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> degree, </span>
<span id="cb139-5"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> prop,</span>
<span id="cb139-6"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin =</span> prop <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>prop_se,</span>
<span id="cb139-7"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax =</span> prop <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>prop_se,</span>
<span id="cb139-8"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> race,</span>
<span id="cb139-9"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> race,</span>
<span id="cb139-10"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> race))</span>
<span id="cb139-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-12"><a aria-hidden="true" tabindex="-1"></a>dodge_w <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="draw-the-plot" class="slide level2">
<h2>Draw the plot</h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb140" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="at">position =</span> dodge_w, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb140-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="at">position =</span> dodge_w, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_format</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb140-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb140-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, </span>
<span id="cb140-6"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, </span>
<span id="cb140-8"><a aria-hidden="true" tabindex="-1"></a>                      <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb140-9"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Educational Attainment by Race"</span>,</span>
<span id="cb140-10"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"GSS 1976-2016"</span>,</span>
<span id="cb140-11"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Race"</span>,</span>
<span id="cb140-12"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Race"</span>,</span>
<span id="cb140-13"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Percent"</span>) <span class="sc">+</span></span>
<span id="cb140-14"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="06-work-with-models_files/figure-revealjs/codefig-barplotreplace-1.png" class="quarto-figure quarto-figure-center" width="460"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="in-full-but-switch-to-rows" class="slide level2">
<h2>In full (but switch to rows)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb141" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb141-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> dodge_w, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb141-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position =</span> dodge_w, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb141-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">wrap_format</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb141-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb141-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, </span>
<span id="cb141-7"><a aria-hidden="true" tabindex="-1"></a>                     <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb141-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, </span>
<span id="cb141-9"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb141-10"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Educational Attainment by Race"</span>,</span>
<span id="cb141-11"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"GSS 1976-2016"</span>,</span>
<span id="cb141-12"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Race"</span>,</span>
<span id="cb141-13"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Race"</span>,</span>
<span id="cb141-14"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Percent"</span>) <span class="sc">+</span></span>
<span id="cb141-15"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb141-16"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> </span>
<span id="cb141-17"><a aria-hidden="true" tabindex="-1"></a>          <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.6</span>), </span>
<span id="cb141-18"><a aria-hidden="true" tabindex="-1"></a>                       <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">


<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-79-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1728"></section>
<section class="slide level2">

<div class="huge">
<p>Is this figure <span class="fg-red">effective</span>? Not really!</p>
</div>
</section>
<section id="lets-try-a-different-view" class="slide level2">
<h2>Let’s try a different view</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb142" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> out_yrd <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(race <span class="sc">%nin%</span> <span class="st">"Other"</span>, </span>
<span id="cb142-4"><a aria-hidden="true" tabindex="-1"></a>         degree <span class="sc">%nin%</span> <span class="st">"Junior College"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb142-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop, </span>
<span id="cb142-6"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> prop <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>prop_se,</span>
<span id="cb142-7"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> prop <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>prop_se, </span>
<span id="cb142-8"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">fill =</span> race, <span class="at">color =</span> race,</span>
<span id="cb142-9"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> race))</span>
<span id="cb142-10"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb142-12"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="cn">NULL</span>),</span>
<span id="cb142-13"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb142-14"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>)) <span class="sc">+</span> </span>
<span id="cb142-15"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb142-16"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb142-17"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb142-18"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> degree, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb142-19"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Educational Attainment by Race"</span>,</span>
<span id="cb142-20"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"GSS 1976-2016"</span>, <span class="at">fill =</span> <span class="st">"Race"</span>,</span>
<span id="cb142-21"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Race"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Percent"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">



<img data-src="06-work-with-models_files/figure-revealjs/06-work-with-models-81-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1152"><div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-spotlight/spotlight.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'spotlight': {"size":60,"lockPointerInsideCanvas":false,"toggleSpotlightOnMouseDown":true,"spotlightOnKeyPressAndHold":false,"spotlightCursor":"none","presentingCursor":"none","initialPresentationMode":true,"disablingUserSelect":true,"fadeInAndOut":100,"useAsPointer":false,"pointerColor":"red"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'slow',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealSpotlight, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/kjhealy\.github\.io\/data_visualization");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>